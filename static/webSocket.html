<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>WebSocket Demo</title>
    <script src="//cdn.bootcss.com/socket.io/1.7.2/socket.io.min.js"></script>
</head>

<body>
    <h1>WebSocket Demo</h1>
    <p>hello world</p>

    <h1>å¤‡æ³¨</h1>
    <pre>
        1ã€å­¦ä¹ å‚è€ƒ  <a href="https://socket.io/docs/">https://socket.io/docs/</a>
        2ã€<a href="http://www.cnblogs.com/xiezhengcai/p/3956401.html">http://www.cnblogs.com/xiezhengcai/p/3956401.html</a>
        3ã€WebSocket protocolæ˜¯HTML5ä¸€ç§æ–°çš„åè®®ã€‚å®ƒå®ç°äº†æµè§ˆå™¨ä¸æœåŠ¡å™¨å…¨åŒå·¥é€šä¿¡ï¼ŒåŒæ—¶å…è®¸è·¨åŸŸé€šè®¯ï¼Œæ˜¯server pushæŠ€æœ¯çš„ä¸€ç§å¾ˆå¥½çš„å®ç°ã€‚
        åŸç”ŸWebSocket APIä½¿ç”¨èµ·æ¥ä¸å¤ªæ–¹ä¾¿ï¼Œæˆ‘ä»¬ä½¿ç”¨Socket.ioï¼Œå®ƒå¾ˆå¥½åœ°å°è£…äº†webSocketæ¥å£ï¼Œæä¾›äº†æ›´ç®€å•ã€çµæ´»çš„æ¥å£ï¼Œä¹Ÿå¯¹ä¸æ”¯æŒwebSocketçš„æµè§ˆå™¨æä¾›äº†å‘ä¸‹å…¼å®¹ã€‚

        //å‰ç«¯------------------------------------------------
        <div>user inputï¼š<input type="text"></div>
        <script src="./socket.io.js"></script>
        <script>
        var socket = io('http://www.domain2.com:8080');

        // è¿æ¥æˆåŠŸå¤„ç†
        socket.on('connect', function() {
            // ç›‘å¬æœåŠ¡ç«¯æ¶ˆæ¯
            socket.on('message', function(msg) {
                console.log('data from server: ---> ' + msg); 
            });

            // ç›‘å¬æœåŠ¡ç«¯å…³é—­
            socket.on('disconnect', function() { 
                console.log('Server socket has closed.'); 
            });
        });

        document.getElementsByTagName('input')[0].onblur = function() {
            socket.send(this.value);
        };
        </script>
        //åå°------------------------------------------------
        var http = require('http');
        var socket = require('socket.io');

        // å¯httpæœåŠ¡
        var server = http.createServer(function(req, res) {
            res.writeHead(200, {
                'Content-type': 'text/html'
            });
            res.end();
        });

        server.listen('8080');
        console.log('Server is running at port 8080...');

        // ç›‘å¬socketè¿æ¥
        socket.listen(server).on('connection', function(client) {
            // æ¥æ”¶ä¿¡æ¯
            client.on('message', function(msg) {
                client.send('helloï¼š' + msg);
                console.log('data from client: ---> ' + msg);
            });

            // æ–­å¼€å¤„ç†
            client.on('disconnect', function() {
                console.log('Client socket has closed.'); 
            });
        });
    </pre>

    <script>
        var p = document.getElementsByTagName('p')[0];
        var io = io.connect('http://127.0.0.1:7001');
        io.on('data', function (data) {
            alert('2såæ”¹å˜æ•°æ®ğŸ‘»');
            p.innerHTML = data
        });
    </script>
</body>

</html>